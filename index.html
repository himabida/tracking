<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BisDig Tracking | Pelacak Keuangan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>
    
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>


  <style>
    :root {
      --primary-color: #4e44ce;
      --primary-light: #6a60d8;
      --primary-dark: #3a32a5;
      --secondary-color: #6c757d;
      --success-color: #28a745;
      --info-color: #17a2b8;
      --warning-color: #ffc107;
      --danger-color: #dc3545;
      --light-color: #f8f9fa;
      --dark-color: #343a40;
      --sidebar-width: 280px;
      --sidebar-collapsed-width: 80px;
      --topbar-height: 70px;
      --card-bg: #ffffff;
      --body-bg: #f5f7fb;
      --text-color: #2d3748;
      --text-muted: #6c757d;
      --border-color: #e2e8f0;
    }

    body {
      font-family: 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background-color: var(--body-bg);
      color: var(--text-color);
      margin: 0;
      overflow-x: hidden;
    }

    /* Pastikan #app-container tersembunyi saat memiliki kelas d-none */
    #app-container.d-none {
        display: none !important;
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      :root {
        --body-bg: #1a202c;
        --card-bg: #2d3748;
        --text-color: #f8f9fa;
        --text-muted: #adb5bd;
        --border-color: #4a5568;
        --light-color: #4a5568;
      }
    }

    /* Login Styles */
    #loginModal .modal-content, #registerModal .modal-content {
      border-radius: 0.75rem;
      background-color: var(--card-bg);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      border: none;
    }

    #loginModal .modal-header, #registerModal .modal-header {
      border-bottom: none;
      padding-bottom: 0;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      color: white;
      border-radius: 0.75rem 0.75rem 0 0;
    }

    #loginModal .modal-title, #registerModal .modal-title {
      font-weight: 700;
    }

    #loginModal .modal-body, #registerModal .modal-body {
      padding-top: 1.5rem;
    }

    .btn-link {
      text-decoration: none;
      color: var(--primary-color);
    }

    /* Sidebar Styles */
    .sidebar {
      background: linear-gradient(180deg, var(--primary-dark) 0%, var(--primary-color) 100%);
      color: white;
      height: 100vh;
      width: var(--sidebar-width);
      position: fixed;
      top: 0;
      left: 0;
      padding: 0;
      z-index: 1000;
      overflow-y: auto;
      box-shadow: 4px 0 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .sidebar.collapsed {
      transform: translateX(-100%);
    }

    .sidebar-header {
      padding: 1.5rem 1.5rem 1rem;
      background-color: rgba(0, 0, 0, 0.1);
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-header h3 {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .user-info {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      opacity: 0.9;
    }

    .sidebar .nav-link {
      color: rgba(255, 255, 255, 0.85);
      padding: 0.8rem 1.5rem;
      font-weight: 600;
      border-left: 3px solid transparent;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      margin: 0.2rem 0.5rem;
      border-radius: 0.5rem;
    }

    .sidebar .nav-link:hover {
      color: white;
      background-color: rgba(255, 255, 255, 0.15);
      transform: translateX(5px);
    }

    .sidebar .nav-link.active {
      color: white;
      background-color: rgba(255, 255, 255, 0.2);
      border-left: 3px solid white;
    }

    .sidebar .nav-link i {
      margin-right: 0.75rem;
      font-size: 1.1rem;
      width: 24px;
      text-align: center;
    }

    .sidebar .nav {
      padding-bottom: 1rem;
    }

    .sidebar-footer {
      padding: 1.5rem;
      width: 100%;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn-export {
      width: 100%;
      background-color: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      padding: 0.75rem;
      font-weight: 600;
      transition: all 0.3s ease;
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-export:hover {
      background-color: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .btn-export i {
      margin-right: 0.5rem;
    }

    .btn-logout {
      margin-top: 0.75rem;
      width: 100%;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background-color: rgba(220, 53, 69, 0.2);
      color: white;
      padding: 0.75rem;
      font-weight: 600;
      transition: all 0.3s ease;
      border-radius: 0.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn-logout:hover {
      background-color: var(--danger-color);
      color: white;
      transform: translateY(-2px);
    }

    .btn-logout i {
      margin-right: 0.5rem;
    }

    /* Main Content Styles */
    main {
      margin-left: 0;
      padding-top: 1rem;
      transition: margin-left 0.3s ease-in-out;
      background-color: var(--body-bg);
      min-height: 100vh;
    }

    /* Top Bar */
    .top-bar {
      background-color: var(--card-bg);
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .page-title {
      font-weight: 700;
      color: var(--primary-color);
      margin: 0;
      font-size: 1.5rem;
    }

    /* Summary Cards */
    .summary-card {
      border-radius: 0.75rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: none;
      background-color: var(--card-bg);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      overflow: hidden;
    }

    .summary-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }

    .summary-card .card-body {
      padding: 1.5rem;
      position: relative;
      z-index: 1;
    }

    .summary-card .card-body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 100%);
      z-index: -1;
    }

    .summary-card .card-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      font-weight: 700;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
      letter-spacing: 0.5px;
    }

    .summary-card .card-amount {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 1rem;
    }

    .summary-card i {
      font-size: 2.5rem;
      opacity: 0.2;
      position: absolute;
      right: 1.5rem;
      bottom: 1.5rem;
    }

    .income-card {
      border-left: 4px solid var(--success-color);
    }

    .income-card .card-body::before {
      background: linear-gradient(135deg, rgba(40, 167, 69, 0.1) 0%, rgba(40, 167, 69, 0) 100%);
    }

    .expense-card {
      border-left: 4px solid var(--danger-color);
    }

    .expense-card .card-body::before {
      background: linear-gradient(135deg, rgba(220, 53, 69, 0.1) 0%, rgba(220, 53, 69, 0) 100%);
    }

    .balance-card {
      border-left: 4px solid var(--primary-color);
    }

    .balance-card .card-body::before {
      background: linear-gradient(135deg, rgba(78, 115, 223, 0.1) 0%, rgba(78, 115, 223, 0) 100%);
    }

    .progress {
      height: 6px;
      border-radius: 3px;
      background-color: rgba(0, 0, 0, 0.05);
    }

    /* Chart Containers */
    .card {
      border: none;
      border-radius: 0.75rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      margin-bottom: 1.5rem;
      background-color: var(--card-bg);
      transition: transform 0.3s ease;
    }

    .card:hover {
      transform: translateY(-3px);
    }

    .card-header {
      background-color: var(--card-bg);
      border-bottom: 1px solid var(--border-color);
      padding: 1.25rem 1.5rem;
      font-weight: 700;
      color: var(--primary-color);
      border-radius: 0.75rem 0.75rem 0 0 !important;
    }

    .card-header h5 {
      font-weight: 700;
      margin: 0;
    }

    .card-body {
      padding: 1.5rem;
    }

    /* Tables */
    .table {
      color: var(--text-color);
      margin-bottom: 0;
    }

    .table th {
      font-weight: 700;
      text-transform: uppercase;
      font-size: 0.75rem;
      color: var(--text-muted);
      background-color: var(--light-color);
      border-color: var(--border-color);
      padding: 0.75rem 1rem;
    }

    .table td {
      padding: 0.75rem 1rem;
      border-color: var(--border-color);
      vertical-align: middle;
    }

    .table-hover tbody tr:hover {
      background-color: rgba(0, 0, 0, 0.03);
    }

    .table-striped tbody tr:nth-of-type(odd) {
      background-color: rgba(0, 0, 0, 0.02);
    }

    /* AI Insights */
    .insight-container {
      min-height: 200px;
      position: relative;
      border-radius: 0.75rem;
      background-color: var(--card-bg);
      padding: 1.5rem;
    }

    .insight-loading {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-color: rgba(255, 255, 255, 0.8);
      z-index: 10;
      border-radius: 0.75rem;
    }

    .insight-content {
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .insight-content.show {
      opacity: 1;
    }

    .insight-item {
      margin-bottom: 1.25rem;
      padding-bottom: 1.25rem;
      border-bottom: 1px solid var(--border-color);
    }

    .insight-item:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    .insight-title {
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
    }

    .insight-title i {
      margin-right: 0.5rem;
    }

    .insight-text {
      font-size: 0.95rem;
      line-height: 1.6;
      color: var(--text-color);
    }

    /* Financial Score */
    .financial-score {
      margin: 1.5rem 0;
    }

    .score-circle {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      background: conic-gradient(var(--success-color) 0%, var(--success-color) 0%, #eee 0%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      position: relative;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      transition: background 1s ease;
    }

    .score-value {
      font-size: 2.75rem;
      font-weight: 700;
      color: var(--primary-color);
    }

    .score-label {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-muted);
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .score-breakdown .breakdown-item {
      margin-bottom: 1rem;
    }

    .breakdown-label {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-color);
      display: block;
      margin-bottom: 0.5rem;
    }

    /* Form Styles */
    .form-control, .form-select {
      padding: 0.65rem 0.75rem;
      font-size: 0.95rem;
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      background-color: var(--card-bg);
      color: var(--text-color);
      transition: all 0.3s ease;
    }

    .form-control:focus, .form-select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.2rem rgba(78, 115, 223, 0.25);
    }

    .form-label {
      font-weight: 600;
      color: var(--text-color);
      margin-bottom: 0.5rem;
    }

    /* Button Styles */
    .btn {
      padding: 0.65rem 1.25rem;
      font-size: 0.95rem;
      font-weight: 600;
      border-radius: 0.5rem;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn i {
      margin-right: 0.5rem;
    }

    .btn-sm {
      padding: 0.4rem 0.8rem;
      font-size: 0.85rem;
    }

    .btn-primary {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }

    .btn-primary:hover {
      background-color: var(--primary-dark);
      border-color: var(--primary-dark);
      transform: translateY(-2px);
    }

    .btn-outline-primary {
      color: var(--primary-color);
      border-color: var(--primary-color);
    }

    .btn-outline-primary:hover {
      background-color: var(--primary-color);
      color: white;
      transform: translateY(-2px);
    }

    .btn-success {
      background-color: var(--success-color);
      border-color: var(--success-color);
    }

    .btn-success:hover {
      background-color: #218838;
      border-color: #1e7e34;
      transform: translateY(-2px);
    }

    .btn-outline-success {
      color: var(--success-color);
      border-color: var(--success-color);
    }

    .btn-outline-success:hover {
      background-color: var(--success-color);
      color: white;
    }

    .btn-danger {
      background-color: var(--danger-color);
      border-color: var(--danger-color);
    }

    .btn-danger:hover {
      background-color: #c82333;
      border-color: #bd2130;
      transform: translateY(-2px);
    }

    .btn-outline-danger {
      color: var(--danger-color);
      border-color: var(--danger-color);
    }

    .btn-outline-danger:hover {
      background-color: var(--danger-color);
      color: white;
      transform: translateY(-2px);
    }

    /* Modal Styles */
    .modal-content {
      border: none;
      border-radius: 0.75rem;
      background-color: var(--card-bg);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
      border-bottom: 1px solid var(--border-color);
      padding: 1.25rem 1.5rem;
    }

    .modal-title {
      font-weight: 700;
      color: var(--primary-color);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      border-top: 1px solid var(--border-color);
      padding: 1.25rem 1.5rem;
    }

    /* Category Items */
    .list-group-item {
      padding: 1rem 1.25rem;
      border: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: var(--card-bg);
      color: var(--text-color);
      transition: all 0.3s ease;
    }

    .list-group-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }

    .category-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
      color: white;
      font-size: 1rem;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .category-name {
      font-weight: 600;
      flex-grow: 1;
    }

    .category-actions .btn {
      padding: 0.35rem 0.65rem;
      font-size: 0.85rem;
      margin-left: 0.5rem;
    }

    /* Transaction Items */
    .transaction-income {
      color: var(--success-color);
      font-weight: 600;
    }

    .transaction-expense {
      color: var(--danger-color);
      font-weight: 600;
    }

    /* Badges */
    .badge {
      font-weight: 600;
      padding: 0.4em 0.75em;
      border-radius: 0.5rem;
    }

    /* Responsive Styles */
    @media (min-width: 768px) {
        .top-bar {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }

    .page-title {
        margin-bottom: 0.5rem;
    }

    .btn-toolbar {
        width: 100%;
        justify-content: space-between;
    }

    #time-period, #add-transaction-btn {
        width: 48%; /* Membagi lebar untuk dua tombol */
    }
      .sidebar {
        transform: translateX(0);
      }
      .sidebar.collapsed {
        transform: translateX(0);
      }
      main {
        margin-left: var(--sidebar-width);
      }
      .sidebar-toggle {
        display: none;
      }
    }

    @media (max-width: 767px) {
      
      .sidebar:not(.collapsed) {
        transform: translateX(0);
      }
      .sidebar:not(.collapsed) + main {
        margin-left: var(--sidebar-width);
      }
      .sidebar.collapsed + main {
        margin-left: 0;
      }
      .summary-card {
        margin-bottom: 1rem;
      }
      .row {
        margin-left: -0.5rem;
        margin-right: -0.5rem;
      }
      .col-md-4, .col-md-6, .col-md-8 {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
      }
        .sidebar-toggle {
        display: flex; /* Tampilkan hanya di mode HP */
    }

    .sidebar {
        transform: translateX(-100%); /* Sembunyikan sidebar secara default di HP */
        transition: transform 0.3s ease-in-out;
    }

    .sidebar.active {
        transform: translateX(0); /* Munculkan sidebar saat aktif */
    }

    main {
        margin-left: 0; /* Reset margin pada mode HP */
        transition: margin-left 0.3s ease-in-out;
    }

    .sidebar.active + main {
        margin-left: var(--sidebar-width); /* Tambah margin saat sidebar aktif */
    }
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 0, 0, 0.3);
    }

    /* Sidebar Toggle Button */
    .sidebar-toggle {
      position: fixed;
      top: 15px;
      right: 15px;
      z-index: 1100;
      font-size: 1.5rem;
      color: var(--primary-color);
      background: var(--card-bg);
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .sidebar-toggle:hover {
      background: var(--primary-color);
      color: white;
      transform: scale(1.1);
    }

    /* Custom Date Range Picker */
    .date-range-picker {
      display: flex;
      gap: 1rem;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .fade-in {
      animation: fadeIn 0.5s ease forwards;
    }

    /* Dark mode toggle */
    .dark-mode-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: var(--primary-color);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .dark-mode-toggle:hover {
      transform: scale(1.1);
    }
  </style>
    
</head>
<body>
    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" style="color:black">Masuk ke BisDig Tracking</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="login-form">
                        <div class="mb-4">
                            <label for="login-email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="login-email" required>
                        </div>
                        <div class="mb-4">
                            <label for="login-password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="login-password" required>
                        </div>
                        <div class="mb-4 form-check">
                            <input type="checkbox" class="form-check-input" id="remember-me">
                            <label class="form-check-label" for="remember-me">Ingat saya</label>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <button type="submit" class="btn btn-primary px-4">
                                <i class="fas fa-sign-in-alt me-2"></i> Masuk
                            </button>
                            <button type="button" class="btn btn-link" id="show-register">Daftar Akun Baru</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" style="color:black">Daftar Akun Baru</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="register-form">
                        <div class="mb-3">
                            <label for="register-name" class="form-label">Nama Lengkap</label>
                            <input type="text" class="form-control" id="register-name" required>
                        </div>
                        <div class="mb-3">
                            <label for="register-email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="register-email" required>
                        </div>
                        <div class="mb-3">
                            <label for="register-password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="register-password" required>
                        </div>
                        <div class="mb-4">
                            <label for="register-confirm-password" class="form-label">Konfirmasi Password</label>
                            <input type="password" class="form-control" id="register-confirm-password" required>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <button type="submit" class="btn btn-primary px-4">
                                <i class="fas fa-user-plus me-2"></i> Daftar
                            </button>
                            <button type="button" class="btn btn-link" id="show-login">Sudah punya akun? Masuk</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App (hidden until login) -->
    <div id="app-container" class="d-none">
        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar Toggle Button (for mobile) -->
                <button class="sidebar-toggle" aria-label="Toggle Sidebar">
                    <i class="bx bx-menu"></i>
                </button>

                <!-- Sidebar -->
                <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block sidebar collapsed">
                    <div class="position-sticky">
                        <div class="sidebar-header">
                            <h3><i class="fas fa-wallet me-2"></i>Budget Genius</h3>
                            <div class="user-info">
                                <small id="sidebar-username">Nama Pengguna</small>
                            </div>
                        </div>
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link active" href="#dashboard" aria-current="page">
                                    <i class="fas fa-home me-2"></i>Beranda
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#transaksi">
                                    <i class="fas fa-exchange-alt me-2"></i>Transaksi
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#kategori">
                                    <i class="fas fa-tags me-2"></i>Kategori
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#laporan">
                                    <i class="fas fa-chart-pie me-2"></i>Laporan
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#analisis">
                                    <i class="fas fa-lightbulb me-2"></i>Analisis AI
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#pengaturan">
                                    <i class="fas fa-cog me-2"></i>Pengaturan
                                </a>
                            </li>
                        </ul>
                        <div class="sidebar-footer">
                            <button class="btn btn-primary btn-export" aria-label="Ekspor Data">
                                <i class="fas fa-file-export me-2"></i>Ekspor Data
                            </button>
                            <button class="btn btn-outline-danger btn-logout mt-3" aria-label="Keluar">
                                <i class="fas fa-sign-out-alt me-2"></i>Keluar
                            </button>
                        </div>
                    </div>
                </nav>

                <!-- Main Content -->
                <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                    <div class="top-bar">
                        <h1 class="page-title" id="page-title">Beranda</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-sm btn-outline-primary" id="time-period">Bulan Ini</button>
                                <button type="button" class="btn btn-sm btn-outline-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown">
                                    <span class="visually-hidden">Toggle Dropdown</span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item time-period-option" href="#" data-period="today">Hari Ini</a></li>
                                    <li><a class="dropdown-item time-period-option" href="#" data-period="week">Minggu Ini</a></li>
                                    <li><a class="dropdown-item time-period-option" href="#" data-period="month">Bulan Ini</a></li>
                                    <li><a class="dropdown-item time-period-option" href="#" data-period="year">Tahun Ini</a></li>
                                    <li><a class="dropdown-item time-period-option" href="#" data-period="custom">Rentang Kustom</a></li>
                                </ul>
                            </div>
                            <button type="button" class="btn btn-success" id="add-transaction-btn">
                                <i class="fas fa-plus me-2"></i> Tambah Transaksi
                            </button>
                        </div>
                    </div>

                    <!-- Dashboard Content -->
                    <div id="dashboard-content" class="page-content">
                        <div class="row mb-4">
                            <div class="col-md-4">
                                <div class="card summary-card income-card">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h6 class="card-title">Pemasukan</h6>
                                                <h2 class="card-amount" id="income-amount">Rp0</h2>
                                            </div>
                                            <i class="fas fa-arrow-down"></i>
                                        </div>
                                        <div class="progress mt-3">
                                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%" id="income-progress"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card summary-card expense-card">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h6 class="card-title">Pengeluaran</h6>
                                                <h2 class="card-amount" id="expense-amount">Rp0</h2>
                                            </div>
                                            <i class="fas fa-arrow-up"></i>
                                        </div>
                                        <div class="progress mt-3">
                                            <div class="progress-bar bg-danger" role="progressbar" style="width: 0%" id="expense-progress"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card summary-card balance-card">
                                    <div class="card-body">
                                                                            <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title">Saldo</h6>
                                            <h2 class="card-amount" id="balance-amount">Rp0</h2>
                                        </div>
                                        <i class="fas fa-wallet"></i>
                                    </div>
                                    <div class="progress mt-3">
                                        <div class="progress-bar bg-primary" role="progressbar" style="width: 0%" id="balance-progress"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Ringkasan Pengeluaran</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="spendingChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Distribusi Kategori</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="categoryChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Transaksi Terakhir</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Tanggal</th>
                                                    <th>Keterangan</th>
                                                    <th>Jumlah</th>
                                                    <th>Kategori</th>
                                                </tr>
                                            </thead>
                                            <tbody id="recent-transactions">
                                                <!-- Transaksi akan dimuat di sini -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Analisis Keuangan</h5>
                                </div>
                                <div class="card-body">
                                    <div class="insight-container">
                                        <div class="insight-loading">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p>Menganalisis data keuangan Anda...</p>
                                        </div>
                                        <div class="insight-content" id="ai-insights">
                                            <!-- Analisis akan dimuat di sini -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transactions Content -->
                <div id="transaksi-content" class="page-content d-none">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4>Semua Transaksi</h4>
                        <div class="btn-group">
                            <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                Filter
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item filter-option" href="#" data-filter="all">Semua</a></li>
                                <li><a class="dropdown-item filter-option" href="#" data-filter="income">Pemasukan</a></li>
                                <li><a class="dropdown-item filter-option" href="#" data-filter="expense">Pengeluaran</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item filter-option" href="#" data-filter="category">Berdasarkan Kategori</a></li>
                            </ul>
                            <button class="btn btn-outline-primary btn-sm" id="sort-transactions">
                                <i class="fas fa-sort-amount-down"></i> Urutkan
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Keterangan</th>
                                    <th>Kategori</th>
                                    <th>Jumlah</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="all-transactions">
                                <!-- Semua transaksi akan dimuat di sini -->
                            </tbody>
                        </table>
                    </div>
                    <nav aria-label="Transaction pagination">
                        <ul class="pagination justify-content-center" id="transaction-pagination">
                            <!-- Pagination akan dimuat di sini -->
                        </ul>
                    </nav>
                </div>

                <!-- Categories Content -->
                <div id="kategori-content" class="page-content d-none">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4>Kategori</h4>
                        <button class="btn btn-primary" id="add-category-btn">
                            <i class="fas fa-plus me-2"></i> Tambah Kategori
                        </button>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header bg-success text-white">
                                    <h5>Kategori Pemasukan</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group" id="income-categories">
                                        <!-- Kategori pemasukan akan dimuat di sini -->
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header bg-danger text-white">
                                    <h5>Kategori Pengeluaran</h5>
                                </div>
                                <div class="card-body">
                                    <ul class="list-group" id="expense-categories">
                                        <!-- Kategori pengeluaran akan dimuat di sini -->
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Content -->
                <div id="laporan-content" class="page-content d-none">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4>Laporan Keuangan</h4>
                        <div class="btn-group">
                            <button class="btn btn-outline-primary" id="export-report-btn">
                                <i class="fas fa-file-export me-2"></i> Ekspor Laporan
                            </button>
                        </div>
                    </div>
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Perbandingan Periode</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <select class="form-select" id="report-period-1">
                                                <option value="this_month">Bulan Ini</option>
                                                <option value="last_month">Bulan Lalu</option>
                                                <option value="this_quarter">Kuartal Ini</option>
                                                <option value="last_quarter">Kuartal Lalu</option>
                                                <option value="this_year">Tahun Ini</option>
                                                <option value="last_year">Tahun Lalu</option>
                                                <option value="custom">Kustom</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <select class="form-select" id="report-period-2">
                                                <option value="last_month">Bulan Lalu</option>
                                                <option value="this_month">Bulan Ini</option>
                                                <option value="last_quarter">Kuartal Lalu</option>
                                                <option value="this_quarter">Kuartal Ini</option>
                                                <option value="last_year">Tahun Lalu</option>
                                                <option value="this_year">Tahun Ini</option>
                                                <option value="custom">Kustom</option>
                                            </select>
                                        </div>
                                    </div>
                                    <canvas id="comparisonChart" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Tren Kategori</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <select class="form-select" id="category-trend-select">
                                            <!-- Kategori akan dimuat di sini -->
                                        </select>
                                    </div>
                                    <canvas id="trendChart" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h5>Laporan Detail</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Kategori</th>
                                            <th>Bulan Ini</th>
                                            <th>Bulan Lalu</th>
                                            <th>Perubahan</th>
                                            <th>% dari Total</th>
                                        </tr>
                                    </thead>
                                    <tbody id="detailed-report">
                                        <!-- Data laporan akan dimuat di sini -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Insights Content -->
                <div id="analisis-content" class="page-content d-none">
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Analisis Kesehatan Keuangan</h5>
                                </div>
                                <div class="card-body">
                                    <div class="insight-container">
                                        <div class="insight-loading">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Loading...</span>
                                            </div>
                                            <p>Menganalisis kesehatan keuangan Anda...</p>
                                        </div>
                                        <div class="insight-content" id="financial-health-insights">
                                            <!-- Analisis akan dimuat di sini -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Skor Keuangan</h5>
                                </div>
                                <div class="card-body text-center">
                                    <div class="financial-score">
                                        <div class="score-circle">
                                            <div class="score-value" id="financial-score">--</div>
                                        </div>
                                        <div class="score-label">Kesehatan Keuangan Keseluruhan</div>
                                    </div>
                                    <div class="score-breakdown mt-3">
                                        <div class="breakdown-item">
                                            <span class="breakdown-label">Tabungan</span>
                                            <div class="progress">
                                                <div class="progress-bar bg-success" role="progressbar" style="width: 0%" id="savings-score"></div>
                                            </div>
                                        </div>
                                        <div class="breakdown-item">
                                            <span class="breakdown-label">Pengeluaran</span>
                                            <div class="progress">
                                                <div class="progress-bar bg-info" role="progressbar" style="width: 0%" id="spending-score"></div>
                                            </div>
                                        </div>
                                        <div class="breakdown-item">
                                            <span class="breakdown-label">Anggaran</span>
                                            <div class="progress">
                                                <div class="progress-bar bg-warning" role="progressbar" style="width: 0%" id="budgeting-score"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5>Rekomendasi Personal</h5>
                                <button class="btn btn-sm btn-outline-primary" id="refresh-insights">
                                    <i class="fas fa-sync-alt me-2"></i> Segarkan
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="insight-container">
                                <div class="insight-loading">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                    <p>Membuat rekomendasi personal...</p>
                                </div>
                                <div class="insight-content" id="recommendations-insights">
                                    <!-- Rekomendasi akan dimuat di sini -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Content -->
                <div id="pengaturan-content" class="page-content d-none">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5>Pengaturan Akun</h5>
                                </div>
                                <div class="card-body">
                                    <form id="account-settings-form">
                                        <div class="mb-3">
                                            <label for="user-name" class="form-label">Nama</label>
                                            <input type="text" class="form-control" id="user-name">
                                        </div>
                                        <div class="mb-3">
                                            <label for="user-email" class="form-label">Email</label>
                                            <input type="email" class="form-control" id="user-email">
                                        </div>
                                        <div class="mb-3">
                                            <label for="user-currency" class="form-label">Mata Uang</label>
                                            <select class="form-select" id="user-currency">
                                                <option value="IDR">Rupiah (Rp)</option>
                                                <option value="USD">Dolar AS ($)</option>
                                                <option value="EUR">Euro (€)</option>
                                                <option value="GBP">Pound Sterling (£)</option>
                                                <option value="JPY">Yen Jepang (¥)</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5>Pengaturan Anggaran</h5>
                                </div>
                                <div class="card-body">
                                    <form id="budget-settings-form">
                                        <div class="mb-3">
                                            <label for="monthly-budget" class="form-label">Anggaran Bulanan</label>
                                            <input type="number" class="form-control" id="monthly-budget" min="0" step="1000">
                                        </div>
                                        <div class="mb-3">
                                            <label for="savings-goal" class="form-label">Target Tabungan (%)</label>
                                            <input type="number" class="form-control" id="savings-goal" min="0" max="100" step="1">
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="notifications-enabled">
                                            <label class="form-check-label" for="notifications-enabled">Aktifkan Notifikasi</label>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Simpan Pengaturan</button>
                                    </form>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header bg-danger text-white">
                                    <h5>Zona Bahaya</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <button class="btn btn-outline-danger" id="export-all-data">
                                            <i class="fas fa-file-export me-2"></i> Ekspor Semua Data
                                        </button>
                                        <small class="text-muted d-block mt-1">Unduh cadangan semua data Anda</small>
                                    </div>
                                    <div class="mb-3">
                                        <button class="btn btn-outline-danger" id="reset-all-data">
                                            <i class="fas fa-trash-alt me-2"></i> Hapus Semua Data
                                        </button>
                                        <small class="text-muted d-block mt-1">Hapus permanen semua data Anda</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
</div>

<!-- Add Transaction Modal -->
<div class="modal fade" id="transactionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="transactionModalTitle">Tambah Transaksi Baru</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="transaction-form">
                    <div class="mb-3">
                        <label for="transaction-type" class="form-label">Jenis</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="transaction-type" id="type-income" value="income" autocomplete="off" checked>
                            <label class="btn btn-outline-success" for="type-income">Pemasukan</label>
                            <input type="radio" class="btn-check" name="transaction-type" id="type-expense" value="expense" autocomplete="off">
                            <label class="btn btn-outline-danger" for="type-expense">Pengeluaran</label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="transaction-amount" class="form-label">Jumlah</label>
                        <div class="input-group">
                            <span class="input-group-text">Rp</span>
                            <input type="number" class="form-control" id="transaction-amount" min="0" step="100" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="transaction-description" class="form-label">Keterangan</label>
                        <input type="text" class="form-control" id="transaction-description" required>
                    </div>
                    <div class="mb-3">
                        <label for="transaction-category" class="form-label">Kategori</label>
                        <select class="form-select" id="transaction-category" required>
                            <!-- Kategori akan dimuat di sini -->
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="transaction-date" class="form-label">Tanggal</label>
                        <input type="date" class="form-control" id="transaction-date" required>
                    </div>
                    <input type="hidden" id="transaction-id">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                <button type="button" class="btn btn-primary" id="save-transaction">Simpan Transaksi</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Category Modal -->
<div class="modal fade" id="categoryModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="categoryModalTitle">Tambah Kategori Baru</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="category-form">
                    <div class="mb-3">
                        <label for="category-name" class="form-label">Nama Kategori</label>
                        <input type="text" class="form-control" id="category-name" required>
                    </div>
                    <div class="mb-3">
                        <label for="category-type" class="form-label">Jenis</label>
                        <select class="form-select" id="category-type" required>
                            <option value="income">Pemasukan</option>
                            <option value="expense">Pengeluaran</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="category-icon" class="form-label">Ikon</label>
                        <select class="form-select" id="category-icon" required>
                            <option value="shopping-cart">Belanja</option>
                            <option value="utensils">Makanan</option>
                            <option value="home">Perumahan</option>
                            <option value="car">Transportasi</option>
                            <option value="tv">Hiburan</option>
                            <option value="heart">Kesehatan</option>
                            <option value="graduation-cap">Pendidikan</option>
                            <option value="gift">Hadiah</option>
                            <option value="money-bill-wave">Gaji</option>
                            <option value="business-time">Bisnis</option>
                            <option value="piggy-bank">Tabungan</option>
                            <option value="dollar-sign">Lainnya</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="category-color" class="form-label">Warna</label>
                        <input type="color" class="form-control form-control-color" id="category-color" value="#563d7c" title="Pilih warna">
                    </div>
                    <input type="hidden" id="category-id">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                <button type="button" class="btn btn-primary" id="save-category">Simpan Kategori</button>
            </div>
        </div>
    </div>
</div>

<!-- Custom Date Range Modal -->
<div class="modal fade" id="dateRangeModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Pilih Rentang Tanggal Kustom</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="date-range-form">
                    <div class="mb-3">
                        <label for="start-date" class="form-label">Tanggal Mulai</label>
                        <input type="date" class="form-control" id="start-date" required>
                    </div>
                    <div class="mb-3">
                        <label for="end-date" class="form-label">Tanggal Selesai</label>
                        <input type="date" class="form-control" id="end-date" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                <button type="button" class="btn btn-primary" id="apply-date-range">Terapkan</button>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalTitle">Konfirmasi Aksi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="confirmationModalBody">
                Apakah Anda yakin ingin melakukan aksi ini?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                <button type="button" class="btn btn-danger" id="confirm-action">Konfirmasi</button>
            </div>
        </div>
    </div>
</div>

<!-- Dark Mode Toggle -->
<div class="dark-mode-toggle" id="darkModeToggle">
    <i class="fas fa-moon"></i>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <!-- Tambahkan ini di bagian Firebase scripts -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script>
    // Initialize Firebase
const firebaseConfig = {
    apiKey: "AIzaSyD1B_aBIvhatHtK9vEOq_00Wx55HOB53FI",
    authDomain: "tracking2-95ed5.firebaseapp.com",
    databaseURL: "https://tracking2-95ed5-default-rtdb.firebaseio.com",
    projectId: "tracking2-95ed5",
    storageBucket: "tracking2-95ed5.appspot.com",
    messagingSenderId: "28636122127",
    appId: "1:28636122127:web:38c89c6fc2abb75fbbe77a",
    measurementId: "G-4NHDRNJE8F"
};

// Initialize Firebase
if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
    firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL);
}
const auth = firebase.auth();
const database = firebase.database();
    // DOM Elements
    const appContainer = document.getElementById('app-container');
    const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
    const registerModal = new bootstrap.Modal(document.getElementById('registerModal'));
    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const showRegisterBtn = document.getElementById('show-register');
    const showLoginBtn = document.getElementById('show-login');
    const logoutBtn = document.querySelector('.btn-logout');

    const sidebar = document.getElementById('sidebar');
    const mainContent = document.querySelector('main');
    const pageContents = document.querySelectorAll('.page-content');
    const navLinks = document.querySelectorAll('.nav-link');
    const pageTitle = document.getElementById('page-title');
    const addTransactionBtn = document.getElementById('add-transaction-btn');
    const transactionModal = new bootstrap.Modal(document.getElementById('transactionModal'));
    const transactionForm = document.getElementById('transaction-form');
    const saveTransactionBtn = document.getElementById('save-transaction');
    const addCategoryBtn = document.getElementById('add-category-btn');
    const categoryModal = new bootstrap.Modal(document.getElementById('categoryModal'));
    const categoryForm = document.getElementById('category-form');
    const saveCategoryBtn = document.getElementById('save-category');
    const timePeriodBtn = document.getElementById('time-period');
    const timePeriodOptions = document.querySelectorAll('.time-period-option');
    const dateRangeModal = new bootstrap.Modal(document.getElementById('dateRangeModal'));
    const applyDateRangeBtn = document.getElementById('apply-date-range');
    const confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'));
    const confirmActionBtn = document.getElementById('confirm-action');
    const exportAllDataBtn = document.getElementById('export-all-data');
    const exportReportBtn = document.getElementById('export-report-btn');
    const refreshInsightsBtn = document.getElementById('refresh-insights');
    const resetAllDataBtn = document.getElementById('reset-all-data');
    const accountSettingsForm = document.getElementById('account-settings-form');
    const budgetSettingsForm = document.getElementById('budget-settings-form');

    // Chart instances
    let spendingChart, categoryChart, comparisonChart, trendChart;

    // App State
    let state = {
        currentUser: null,
        users: {},
        transactions: [],
        categories: [],
        currentPeriod: 'month',
        currentPage: 'dashboard',
        editingTransaction: null,
        editingCategory: null
    };

    // Initialize the app
    function init() {
        console.log('Initializing application...');
        
        // Show login modal first
        loginModal.show();
        
        // Setup event listeners
        setupEventListeners();
        
        // Check for remembered user
        const rememberedEmail = localStorage.getItem('rememberedEmail');
        if (rememberedEmail) {
            document.getElementById('login-email').value = rememberedEmail;
            document.getElementById('remember-me').checked = true;
        }
    }

    // Encode email for Firebase key
    function encodeEmail(email) {
        return email.replace(/\./g, ',');
    }

    // Check if user exists in Firebase
    function checkUserExists(email, callback) {
        database.ref('users/' + encodeEmail(email)).once('value')
            .then((snapshot) => {
                callback(snapshot.exists());
            })
            .catch((error) => {
                console.error('Error checking user:', error);
                callback(false);
            });
    }

    // Load user data from Firebase
    function loadUserData(email, callback) {
        const encodedEmail = encodeEmail(email);
        
        database.ref('users/' + encodedEmail).once('value')
            .then((snapshot) => {
                const userData = snapshot.val();
                if (userData) {
                    if (!userData.categories) {
                        userData.categories = getDefaultCategories();
                        database.ref('users/' + encodedEmail + '/categories').set(userData.categories);
                    }
                    callback(userData);
                } else {
                    callback(null);
                }
            })
            .catch((error) => {
                console.error('Error loading user data:', error);
                alert('Gagal memuat data pengguna. Periksa koneksi internet Anda.');
                callback(null);
            });
    }

    // Get default categories
    function getDefaultCategories() {
        return [
            { id: 1, name: 'Gaji', type: 'income', icon: 'money-bill-wave', color: '#28a745' },
            { id: 2, name: 'Freelance', type: 'income', icon: 'laptop-code', color: '#17a2b8' },
            { id: 3, name: 'Makanan', type: 'expense', icon: 'utensils', color: '#dc3545' },
            { id: 4, name: 'Transportasi', type: 'expense', icon: 'bus', color: '#fd7e14' },
            { id: 5, name: 'Hiburan', type: 'expense', icon: 'film', color: '#6f42c1' },
            { id: 6, name: 'Sewa Rumah', type: 'expense', icon: 'home', color: '#343a40' }
        ];
    }

    // Save user data to Firebase
    function saveUserData(email, data) {
        const encodedEmail = encodeEmail(email);
        return database.ref('users/' + encodedEmail).set(data);
    }

    // Save state to localStorage and sync to Firebase
    function saveToLocalStorage() {
        localStorage.setItem('appState', JSON.stringify(state));
        if (state.currentUser) {
            saveUserData(state.currentUser, state.users[state.currentUser]);
        }
    }

    // Fungsi untuk menampilkan alert
function showAlert(type, message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
    alertDiv.setAttribute('role', 'alert');
    alertDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check' : 'exclamation'}-circle me-2"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    `;
    
    const existingAlert = document.querySelector('.alert');
    if (existingAlert) {
        existingAlert.remove();
    }
    
    document.body.prepend(alertDiv);
    
    // Auto dismiss setelah 5 detik
    setTimeout(() => {
        const bsAlert = new bootstrap.Alert(alertDiv);
        bsAlert.close();
    }, 5000);
}

// Fungsi untuk handle error auth
function handleAuthError(error) {
    let errorMessage = 'Terjadi kesalahan saat autentikasi. Silakan coba lagi.';
    
    switch (error.code) {
        case 'auth/email-already-in-use':
            errorMessage = 'Email sudah terdaftar. Gunakan email lain atau lakukan login.';
            break;
        case 'auth/invalid-email':
            errorMessage = 'Format email tidak valid.';
            break;
        case 'auth/weak-password':
            errorMessage = 'Password terlalu lemah. Minimal 6 karakter.';
            break;
        case 'auth/operation-not-allowed':
            errorMessage = 'Operasi registrasi tidak diizinkan. Hubungi admin.';
            break;
        case 'auth/network-request-failed':
            errorMessage = 'Gagal terhubung ke jaringan. Periksa koneksi internet Anda.';
            break;
        case 'auth/user-not-found':
            errorMessage = 'Email tidak terdaftar.';
            break;
        case 'auth/wrong-password':
            errorMessage = 'Password salah.';
            break;
        case 'auth/too-many-requests':
            errorMessage = 'Terlalu banyak percobaan login. Coba lagi nanti.';
            break;
        case 'auth/user-disabled':
            errorMessage = 'Akun ini dinonaktifkan. Hubungi administrator.';
            break;
    }
    
    showAlert('danger', errorMessage);
}
        
    // Setup event listeners
    function setupEventListeners() {
// Fungsi untuk menangani login
// Fungsi login yang diperbarui
loginForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value;
    const rememberMe = document.getElementById('remember-me').checked;

    // Validasi input
    if (!email || !password) {
        showAlert('danger', 'Harap isi email dan password');
        return;
    }

    // Disable tombol dan tampilkan loading
    const loginBtn = loginForm.querySelector('button[type="submit"]');
    const originalBtnText = loginBtn.innerHTML;
    loginBtn.disabled = true;
    loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Masuk...';

    try {
        // Login dengan Firebase Auth
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        
        if (rememberMe) {
            localStorage.setItem('rememberedEmail', email);
        } else {
            localStorage.removeItem('rememberedEmail');
        }

        // Login berhasil
        loginModal.hide();
        await loginUser(userCredential.user);
    } catch (error) {
        console.error('Error login:', error);
        handleAuthError(error);
    } finally {
        // Reset tombol login
        loginBtn.disabled = false;
        loginBtn.innerHTML = originalBtnText;
    }
});

// Fungsi untuk memuat data user
// Fungsi login yang diperbarui
async function loginUser(firebaseUser) {
    try {
        // Ambil data user dari database menggunakan UID
        const snapshot = await database.ref('users/' + firebaseUser.uid).once('value');
        const userData = snapshot.val();

        if (!userData) {
            throw new Error('Data pengguna tidak ditemukan');
        }

        // Update state aplikasi
        state.currentUser = firebaseUser.uid;
        state.users[firebaseUser.uid] = userData;
        state.transactions = userData.transactions || [];
        state.categories = userData.categories || getDefaultCategories();

        // Update UI
        document.getElementById('sidebar-username').textContent = userData.name;
        appContainer.classList.remove('d-none');
        
        // Initialize UI
        renderCategoriesDropdown();
        renderAllCategories();
        updateDashboard();
        renderRecentTransactions();
        renderAllTransactions();
        renderUserSettings();
        showPage('dashboard');
        
        // Tampilkan notifikasi sukses
        showAlert('success', `Selamat datang, ${userData.name}!`);
    } catch (error) {
        console.error('Error loading user data:', error);
        showAlert('danger', 'Gagal memuat data pengguna. Silakan coba lagi.');
        
        // Logout jika ada masalah
        await auth.signOut();
    }
}


// Register form
registerForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const name = document.getElementById('register-name').value.trim();
    const email = document.getElementById('register-email').value.trim();
    const password = document.getElementById('register-password').value;
    const confirmPassword = document.getElementById('register-confirm-password').value;

    // Validasi input lebih ketat
    if (!name || name.length < 3) {
        showAlert('danger', 'Nama minimal 3 karakter');
        return;
    }

    if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        showAlert('danger', 'Format email tidak valid');
        return;
    }

    if (!password || password.length < 6) {
        showAlert('danger', 'Password minimal 6 karakter');
        return;
    }

    if (password !== confirmPassword) {
        showAlert('danger', 'Password dan konfirmasi tidak cocok');
        return;
    }

    // Tampilkan loading
    const registerBtn = registerForm.querySelector('button[type="submit"]');
    const originalText = registerBtn.innerHTML;
    registerBtn.disabled = true;
    registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Mendaftarkan...';

    try {
        // 1. Buat akun di Firebase Auth
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        
        // 2. Simpan data tambahan ke Realtime Database
        const userData = {
            name,
            email,
            currency: 'IDR',
            monthlyBudget: 0,
            savingsGoal: 20,
            notificationsEnabled: true,
            transactions: [],
            categories: getDefaultCategories(),
            createdAt: firebase.database.ServerValue.TIMESTAMP
        };

        // Simpan ke database dengan path users/<uid>
        await database.ref('users/' + userCredential.user.uid).set(userData);

        // Registrasi sukses
        registerModal.hide();
        showAlert('success', 'Registrasi berhasil! Mengarahkan ke dashboard...');
        
        // Auto login
        await loginUser(userCredential.user);
    } catch (error) {
        console.error('Error registrasi:', error);
        
        // Tampilkan error spesifik
        let errorMessage = 'Terjadi kesalahan saat registrasi';
        if (error.code === 'auth/email-already-in-use') {
            errorMessage = 'Email sudah terdaftar';
        } else if (error.code === 'auth/weak-password') {
            errorMessage = 'Password terlalu lemah (minimal 6 karakter)';
        } else if (error.code === 'auth/network-request-failed') {
            errorMessage = 'Gagal terhubung ke jaringan';
        }
        
        showAlert('danger', errorMessage);
    } finally {
        // Reset tombol
        registerBtn.disabled = false;
        registerBtn.innerHTML = originalText;
    }
});


        // Toggle between login and register
        showRegisterBtn.addEventListener('click', function() {
            loginModal.hide();
            registerModal.show();
        });

        showLoginBtn.addEventListener('click', function() {
            registerModal.hide();
            loginModal.show();
        });

        // Logout
        // Logout
logoutBtn.addEventListener('click', async function() {
    try {
        await auth.signOut();
        state.currentUser = null;
        state.users = {};
        state.transactions = [];
        state.categories = [];
        appContainer.classList.add('d-none');
        loginModal.show();
    } catch (error) {
        console.error('Error saat logout:', error);
        showAlert('danger', 'Gagal logout. Silakan coba lagi.');
    }
});

        // Navigation links
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const page = link.getAttribute('href').substring(1);
                showPage(page);
            });
        });
// Sidebar toggle untuk mode HP
    const sidebarToggle = document.querySelector('.sidebar-toggle');
    sidebarToggle.addEventListener('click', function() {
        const sidebar = document.getElementById('sidebar');
        sidebar.classList.toggle('active');
    });
        

        // Add transaction
        addTransactionBtn.addEventListener('click', function() {
            state.editingTransaction = null;
            transactionForm.reset();
            document.getElementById('transactionModalTitle').textContent = 'Tambah Transaksi Baru';
            document.getElementById('transaction-date').value = formatDate(new Date());
            renderCategoriesDropdown();
            transactionModal.show();
        });

        // Save transaction
        saveTransactionBtn.addEventListener('click', function() {
            const amount = parseFloat(document.getElementById('transaction-amount').value);
            const description = document.getElementById('transaction-description').value.trim();
            const categoryId = parseInt(document.getElementById('transaction-category').value);
            const date = document.getElementById('transaction-date').value;
            const type = document.querySelector('input[name="transaction-type"]:checked').value;
            
            if (!amount || !description || !categoryId || !date) {
                alert('Harap isi semua field');
                return;
            }

            const transactionData = {
                id: state.editingTransaction ? state.editingTransaction.id : state.transactions.length > 0 
                    ? Math.max(...state.transactions.map(t => t.id)) + 1 
                    : 1,
                amount,
                description,
                categoryId,
                date,
                type
            };

            if (state.editingTransaction) {
                const index = state.transactions.findIndex(t => t.id === state.editingTransaction.id);
                state.transactions[index] = transactionData;
            } else {
                state.transactions.push(transactionData);
            }

            state.users[state.currentUser].transactions = state.transactions;
            saveToLocalStorage();
    
            transactionModal.hide();
                    updateDashboard();
        renderRecentTransactions();
        renderAllTransactions();
    });

    // Add category
    addCategoryBtn.addEventListener('click', function() {
        state.editingCategory = null;
        categoryForm.reset();
        document.getElementById('categoryModalTitle').textContent = 'Tambah Kategori Baru';
        categoryModal.show();
    });

    // Save category
    saveCategoryBtn.addEventListener('click', function() {
        const name = document.getElementById('category-name').value.trim();
        const type = document.getElementById('category-type').value;
        const icon = document.getElementById('category-icon').value;
        const color = document.getElementById('category-color').value;
        
        if (!name) {
            alert('Harap masukkan nama kategori');
            return;
        }

        const categoryData = {
            id: state.editingCategory ? state.editingCategory.id : state.categories.length > 0 
                ? Math.max(...state.categories.map(c => c.id)) + 1 
                : 1,
            name,
            type,
            icon,
            color
        };

        if (state.editingCategory) {
            const index = state.categories.findIndex(c => c.id === state.editingCategory.id);
            state.categories[index] = categoryData;
        } else {
            state.categories.push(categoryData);
        }

        state.users[state.currentUser].categories = state.categories;
        saveToLocalStorage();

        categoryModal.hide();
        renderCategoriesDropdown();
        renderAllCategories();
        updateDashboard();
    });

    // Time period selection
    timePeriodOptions.forEach(option => {
        option.addEventListener('click', (e) => {
            e.preventDefault();
            const period = option.getAttribute('data-period');
            if (period === 'custom') {
                dateRangeModal.show();
            } else {
                state.currentPeriod = period;
                timePeriodBtn.textContent = option.textContent;
                updateDashboard();
                renderRecentTransactions();
                renderAllTransactions();
            }
        });
    });

    // Apply date range
    applyDateRangeBtn.addEventListener('click', function() {
        const startDate = document.getElementById('start-date').value;
        const endDate = document.getElementById('end-date').value;
        
        if (startDate && endDate) {
            state.currentPeriod = { start: startDate, end: endDate };
            timePeriodBtn.textContent = `${formatDisplayDate(startDate)} - ${formatDisplayDate(endDate)}`;
            updateDashboard();
            renderRecentTransactions();
            renderAllTransactions();
            dateRangeModal.hide();
        }
    });

    // Export data
    exportAllDataBtn.addEventListener('click', exportAllData);
    exportReportBtn.addEventListener('click', exportReport);

    // Reset data
    resetAllDataBtn.addEventListener('click', function() {
        showConfirmation(
            'Hapus Semua Data',
            'Apakah Anda yakin ingin menghapus semua data? Aksi ini tidak dapat dibatalkan.',
            resetAllData
        );
    });

    // Refresh insights
    refreshInsightsBtn.addEventListener('click', generateInsights);

    // Account settings
    accountSettingsForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const name = document.getElementById('user-name').value;
        const email = document.getElementById('user-email').value;
        
        if (email !== state.currentUser) {
            if (state.users[email]) {
                alert('Email sudah digunakan oleh akun lain');
                return;
            }
            
            state.users[email] = state.users[state.currentUser];
            delete state.users[state.currentUser];
            state.currentUser = email;
        }
        
        state.users[state.currentUser].name = name;
        state.users[state.currentUser].email = email;
        
        document.getElementById('sidebar-username').textContent = name;
        
        saveToLocalStorage();
        alert('Pengaturan akun berhasil disimpan');
    });

    // Budget settings
    budgetSettingsForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const monthlyBudget = parseFloat(document.getElementById('monthly-budget').value) || 0;
        const savingsGoal = parseInt(document.getElementById('savings-goal').value) || 0;
        const notificationsEnabled = document.getElementById('notifications-enabled').checked;
        
        state.users[state.currentUser].monthlyBudget = monthlyBudget;
        state.users[state.currentUser].savingsGoal = savingsGoal;
        state.users[state.currentUser].notificationsEnabled = notificationsEnabled;
        
        saveToLocalStorage();
        updateDashboard();
        alert('Pengaturan anggaran berhasil disimpan');
    });
}

// Login user
function loginUser(email) {
    loadUserData(email, (userData) => {
        if (!userData) {
            alert('Terjadi kesalahan saat memuat data pengguna');
            loginModal.show();
            return;
        }

        state.currentUser = email;
        state.users[email] = userData;
        state.transactions = userData.transactions || [];
        state.categories = userData.categories || getDefaultCategories();

        // Update UI
        document.getElementById('sidebar-username').textContent = userData.name;
        appContainer.classList.remove('d-none');
        sidebar.classList.add('active');

        // Close modal and remove backdrop
        loginModal.hide();
        document.querySelectorAll('.modal-backdrop').forEach(backdrop => backdrop.remove());
        document.body.classList.remove('modal-open');
        document.body.style.overflow = '';

        // Initialize UI
        renderCategoriesDropdown();
        renderAllCategories();
        updateDashboard();
        renderRecentTransactions();
        renderAllTransactions();
        renderUserSettings();
        showPage('dashboard');
    });
}

// Show specific page content
function showPage(page) {
    state.currentPage = page;
    
    navLinks.forEach(link => {
        link.classList.remove('active');
        if (link.getAttribute('href').substring(1) === page) {
            link.classList.add('active');
        }
    });

    pageContents.forEach(content => {
        content.classList.add('d-none');
    });

    document.getElementById(`${page}-content`).classList.remove('d-none');
    
    const pageTitles = {
        'dashboard': 'Beranda',
        'transaksi': 'Transaksi',
        'kategori': 'Kategori',
        'laporan': 'Laporan',
        'analisis': 'Analisis',
        'pengaturan': 'Pengaturan'
    };
    pageTitle.textContent = pageTitles[page];
    
    switch (page) {
        case 'dashboard':
            updateDashboard();
            break;
        case 'transaksi':
            renderAllTransactions();
            break;
        case 'kategori':
            renderAllCategories();
            break;
        case 'laporan':
            renderReports();
            break;
        case 'analisis':
            generateInsights();
            break;
        case 'pengaturan':
            renderUserSettings();
            break;
    }
}

// Format date as YYYY-MM-DD
function formatDate(date) {
    const d = new Date(date);
    let month = '' + (d.getMonth() + 1);
    let day = '' + d.getDate();
    const year = d.getFullYear();

    if (month.length < 2) month = '0' + month;
    if (day.length < 2) day = '0' + day;

    return [year, month, day].join('-');
}

// Format date for display (e.g., 1 Jan 2023)
function formatDisplayDate(dateStr) {
    const options = { year: 'numeric', month: 'short', day: 'numeric' };
    return new Date(dateStr).toLocaleDateString('id-ID', options);
}

// Format currency
function formatCurrency(amount) {
    if (state.users[state.currentUser].currency === 'IDR') {
        return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount);
    } else {
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: state.users[state.currentUser].currency }).format(amount);
    }
}

// Render categories dropdown
function renderCategoriesDropdown() {
    const dropdown = document.getElementById('transaction-category');
    dropdown.innerHTML = '';
    
    const incomeCategories = state.categories.filter(c => c.type === 'income');
    const expenseCategories = state.categories.filter(c => c.type === 'expense');
    
    if (incomeCategories.length > 0) {
        const incomeGroup = document.createElement('optgroup');
        incomeGroup.label = 'Pemasukan';
        incomeCategories.forEach(category => {
            incomeGroup.innerHTML += `<option value="${category.id}">${category.name}</option>`;
        });
        dropdown.appendChild(incomeGroup);
    }
    
    if (expenseCategories.length > 0) {
        const expenseGroup = document.createElement('optgroup');
        expenseGroup.label = 'Pengeluaran';
        expenseCategories.forEach(category => {
            expenseGroup.innerHTML += `<option value="${category.id}">${category.name}</option>`;
        });
        dropdown.appendChild(expenseGroup);
    }
}

// Render all categories
function renderAllCategories() {
    const incomeList = document.getElementById('income-categories');
    const expenseList = document.getElementById('expense-categories');
    
    incomeList.innerHTML = '';
    expenseList.innerHTML = '';
    
    state.categories.forEach(category => {
        const item = document.createElement('li');
        item.className = 'list-group-item d-flex justify-content-between align-items-center';
        
        item.innerHTML = `
            <div class="d-flex align-items-center">
                <div class="category-icon" style="background-color: ${category.color}">
                    <i class="fas fa-${category.icon}"></i>
                </div>
                <span class="category-name">${category.name}</span>
            </div>
            <div class="category-actions">
                <button class="btn btn-sm btn-outline-primary edit-category" data-id="${category.id}">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger delete-category" data-id="${category.id}">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `;
        
        if (category.type === 'income') {
            incomeList.appendChild(item);
        } else {
            expenseList.appendChild(item);
        }
    });
    
    // Edit category
    document.querySelectorAll('.edit-category').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const id = parseInt(btn.getAttribute('data-id'));
            const category = state.categories.find(c => c.id === id);
            
            if (category) {
                state.editingCategory = category;
                document.getElementById('categoryModalTitle').textContent = 'Edit Kategori';
                document.getElementById('category-name').value = category.name;
                document.getElementById('category-type').value = category.type;
                document.getElementById('category-icon').value = category.icon;
                document.getElementById('category-color').value = category.color;
                document.getElementById('category-id').value = category.id;
                categoryModal.show();
            }
        });
    });
    
    // Delete category
    document.querySelectorAll('.delete-category').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const id = parseInt(btn.getAttribute('data-id'));
            const category = state.categories.find(c => c.id === id);
            
            if (category) {
                showConfirmation(
                    'Hapus Kategori',
                    `Apakah Anda yakin ingin menghapus kategori "${category.name}"?`,
                    () => {
                        state.categories = state.categories.filter(c => c.id !== id);
                        state.users[state.currentUser].categories = state.categories;
                        saveToLocalStorage();
                        renderAllCategories();
                        renderCategoriesDropdown();
                        updateDashboard();
                    }
                );
            }
        });
    });
}

// Filter transactions based on current period
function filterTransactionsByPeriod() {
    const now = new Date();
    let startDate, endDate;
    
    switch (state.currentPeriod) {
        case 'today':
            startDate = endDate = formatDate(now);
            break;
        case 'week':
            startDate = new Date(now);
            startDate.setDate(now.getDate() - now.getDay());
            endDate = new Date(now);
            endDate.setDate(now.getDate() + (6 - now.getDay()));
            startDate = formatDate(startDate);
            endDate = formatDate(endDate);
            break;
        case 'month':
            startDate = new Date(now.getFullYear(), now.getMonth(), 1);
            endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
            startDate = formatDate(startDate);
            endDate = formatDate(endDate);
            break;
        case 'year':
            startDate = new Date(now.getFullYear(), 0, 1);
            endDate = new Date(now.getFullYear(), 11, 31);
            startDate = formatDate(startDate);
            endDate = formatDate(endDate);
            break;
        default:
            if (typeof state.currentPeriod === 'object') {
                startDate = state.currentPeriod.start;
                endDate = state.currentPeriod.end;
            } else {
                startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                startDate = formatDate(startDate);
                endDate = formatDate(endDate);
            }
    }
    
    return state.transactions.filter(transaction => {
        return transaction.date >= startDate && transaction.date <= endDate;
    });
}

// Calculate totals from transactions
function calculateTotals(transactions) {
    const totalIncome = transactions
        .filter(t => t.type === 'income')
        .reduce((sum, t) => sum + t.amount, 0);
    
    const totalExpense = transactions
        .filter(t => t.type === 'expense')
        .reduce((sum, t) => sum + t.amount, 0);
    
    const balance = totalIncome - totalExpense;
    
    return { totalIncome, totalExpense, balance };
}

// Update dashboard with summary and charts
function updateDashboard() {
    const filteredTransactions = filterTransactionsByPeriod();
    const { totalIncome, totalExpense, balance } = calculateTotals(filteredTransactions);
    
    document.getElementById('income-amount').textContent = formatCurrency(totalIncome);
    document.getElementById('expense-amount').textContent = formatCurrency(totalExpense);
    document.getElementById('balance-amount').textContent = formatCurrency(balance);
    
    const incomePercentage = state.users[state.currentUser].monthlyBudget ? Math.min(100, (totalIncome / state.users[state.currentUser].monthlyBudget) * 100) : 0;
    const expensePercentage = state.users[state.currentUser].monthlyBudget ? Math.min(100, (totalExpense / state.users[state.currentUser].monthlyBudget) * 100) : 0;
    const balancePercentage = state.users[state.currentUser].monthlyBudget ? Math.min(100, (balance / state.users[state.currentUser].monthlyBudget) * 100) : 0;
    
    document.getElementById('income-progress').style.width = `${incomePercentage}%`;
    document.getElementById('expense-progress').style.width = `${expensePercentage}%`;
    document.getElementById('balance-progress').style.width = `${balancePercentage}%`;
    
    renderSpendingChart(filteredTransactions);
    renderCategoryChart(filteredTransactions);
    
    if (state.currentPage === 'dashboard' || state.currentPage === 'analisis') {
        generateInsights();
    }
}

// Render spending chart
function renderSpendingChart(transactions) {
    const ctx = document.getElementById('spendingChart').getContext('2d');
    
    const dates = {};
    transactions.forEach(t => {
        if (!dates[t.date]) {
            dates[t.date] = { income: 0, expense: 0 };
        }
        dates[t.date][t.type] += t.amount;
    });
    
    const sortedDates = Object.keys(dates).sort();
    const incomeData = sortedDates.map(date => dates[date].income);
    const expenseData = sortedDates.map(date => dates[date].expense);
    
    if (spendingChart) {
        spendingChart.destroy();
    }
    
    spendingChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: sortedDates.map(date => formatDisplayDate(date)),
            datasets: [
                {
                    label: 'Pemasukan',
                    data: incomeData,
                    backgroundColor: 'rgba(40, 167, 69, 0.7)',
                    borderColor: 'rgba(40, 167, 69, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Pengeluaran',
                    data: expenseData,
                    backgroundColor: 'rgba(220, 53, 69, 0.7)',
                    borderColor: 'rgba(220, 53, 69, 1)',
                    borderWidth: 1
                }
            ]
        },
        options: {
            responsive: true,
            animation: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return formatCurrency(value);
                        }
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            label += formatCurrency(context.raw);
                            return label;
                        }
                    }
                }
            }
        }
    });
}

// Render category chart
function renderCategoryChart(transactions) {
    const ctx = document.getElementById('categoryChart').getContext('2d');
    
    const expensesByCategory = {};
    transactions
        .filter(t => t.type === 'expense')
        .forEach(t => {
            const category = state.categories.find(c => c.id === t.categoryId);
            const categoryName = category ? category.name : 'Lain-Lain';
            if (!expensesByCategory[categoryName]) {
                expensesByCategory[categoryName] = 0;
            }
            expensesByCategory[categoryName] += t.amount;
        });
    
    const categoryNames = Object.keys(expensesByCategory);
    const categoryAmounts = categoryNames.map(name => expensesByCategory[name]);
    const categoryColors = categoryNames.map(name => {
        const category = state.categories.find(c => c.name === name);
        return category ? category.color : '#6c757d';
    });
    
    if (categoryChart) {
        categoryChart.destroy();
    }
    
    categoryChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: categoryNames,
            datasets: [{
                data: categoryAmounts,
                backgroundColor: categoryColors,
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            animation: false,
            plugins: {
                legend: {
                    position: 'right',
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const value = context.raw;
                            const percentage = Math.round((value / total) * 100);
                            return `${context.label}: ${formatCurrency(value)} (${percentage}%)`;
                        }
                    }
                }
            }
        }
    });
}

// Render recent transactions
function renderRecentTransactions() {
    const container = document.getElementById('recent-transactions');
    const filteredTransactions = filterTransactionsByPeriod()
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .slice(0, 5);
    
    container.innerHTML = '';
    
    if (filteredTransactions.length === 0) {
        container.innerHTML = '<tr><td colspan="4" class="text-center">Tidak ada transaksi</td></tr>';
        return;
    }
    
    filteredTransactions.forEach(transaction => {
        const category = state.categories.find(c => c.id === transaction.categoryId);
        const categoryName = category ? category.name : 'Lainnya';
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${formatDisplayDate(transaction.date)}</td>
            <td>${transaction.description}</td>
            <td class="${transaction.type === 'income' ? 'transaction-income' : 'transaction-expense'}">
                ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}
            </td>
            <td>${categoryName}</td>
        `;
        
        container.appendChild(row);
    });
}

// Render all transactions with pagination
function renderAllTransactions(page = 1, perPage = 10) {
    const container = document.getElementById('all-transactions');
    const pagination = document.getElementById('transaction-pagination');
    const filteredTransactions = filterTransactionsByPeriod()
        .sort((a, b) => new Date(b.date) - new Date(a.date));
    
    container.innerHTML = '';
    
    if (filteredTransactions.length === 0) {
        container.innerHTML = '<tr><td colspan="5" class="text-center">Tidak ada transaksi</td></tr>';
        pagination.innerHTML = '';
        return;
    }

    const totalPages = Math.ceil(filteredTransactions.length / perPage);
    const startIndex = (page - 1) * perPage;
    const endIndex = Math.min(startIndex + perPage, filteredTransactions.length);
    const paginatedTransactions = filteredTransactions.slice(startIndex, endIndex);
    
    paginatedTransactions.forEach(transaction => {
        const category = state.categories.find(c => c.id === transaction.categoryId);
        const categoryName = category ? category.name : 'Lainnya';
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${formatDisplayDate(transaction.date)}</td>
            <td>${transaction.description}</td>
            <td>${categoryName}</td>
            <td class="${transaction.type === 'income' ? 'transaction-income' : 'transaction-expense'}">
                ${transaction.type === 'income' ? '+' : '-'}${formatCurrency(transaction.amount)}
            </td>
            <td>
                <button class="btn btn-sm btn-outline-primary edit-transaction" data-id="${transaction.id}">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger delete-transaction" data-id="${transaction.id}">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        `;
        
        container.appendChild(row);
    });
    
    // Edit transaction
    document.querySelectorAll('.edit-transaction').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const id = parseInt(btn.getAttribute('data-id'));
            const transaction = state.transactions.find(t => t.id === id);
            
            if (transaction) {
                state.editingTransaction = transaction;
                document.getElementById('transactionModalTitle').textContent = 'Edit Transaksi';
                document.getElementById('transaction-amount').value = transaction.amount;
                document.getElementById('transaction-description').value = transaction.description;
                document.getElementById('transaction-category').value = transaction.categoryId;
                document.getElementById('transaction-date').value = transaction.date;
                document.getElementById(`type-${transaction.type}`).checked = true;
                document.getElementById('transaction-id').value = transaction.id;
                transactionModal.show();
            }
        });
    });
    
    // Delete transaction
    document.querySelectorAll('.delete-transaction').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const id = parseInt(btn.getAttribute('data-id'));
            const transaction = state.transactions.find(t => t.id === id);
            
            if (transaction) {
                showConfirmation(
                    'Hapus Transaksi',
                    `Apakah Anda yakin ingin menghapus transaksi: "${transaction.description}"?`,
                    () => {
                        state.transactions = state.transactions.filter(t => t.id !== id);
                        state.users[state.currentUser].transactions = state.transactions;
                        saveToLocalStorage();
                        updateDashboard();
                        renderRecentTransactions();
                        renderAllTransactions(page, perPage);
                    }
                );
            }
        });
    });
    
    // Pagination
    pagination.innerHTML = '';
    
    if (totalPages > 1) {
        const prevLi = document.createElement('li');
        prevLi.className = `page-item ${page === 1 ? 'disabled' : ''}`;
        prevLi.innerHTML = `<a class="page-link" href="#" aria-label="Previous" data-page="${page - 1}">
            <span aria-hidden="true">«</span>
        </a>`;
        pagination.appendChild(prevLi);
        
        for (let i = 1; i <= totalPages; i++) {
            const li = document.createElement('li');
            li.className = `page-item ${i === page ? 'active' : ''}`;
            li.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
            pagination.appendChild(li);
        }
        
        const nextLi = document.createElement('li');
        nextLi.className = `page-item ${page === totalPages ? 'disabled' : ''}`;
        nextLi.innerHTML = `<a class="page-link" href="#" aria-label="Next" data-page="${page + 1}">
            <span aria-hidden="true">»</span>
        </a>`;
        pagination.appendChild(nextLi);
        
        document.querySelectorAll('.page-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageNum = parseInt(link.getAttribute('data-page'));
                if (!isNaN(pageNum)) {
                    renderAllTransactions(pageNum, perPage);
                }
            });
        });
    }
}

// Render reports
function renderReports() {
    const monthlyData = {};
    state.transactions.forEach(t => {
        const date = new Date(t.date);
        const monthYear = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
        
        if (!monthlyData[monthYear]) {
            monthlyData[monthYear] = { income: 0, expense: 0 };
        }
        monthlyData[monthYear][t.type] += t.amount;
    });
    
    const sortedMonths = Object.keys(monthlyData).sort();
    const incomeData = sortedMonths.map(month => monthlyData[month].income);
    const expenseData = sortedMonths.map(month => monthlyData[month].expense);
    
    const comparisonCtx = document.getElementById('comparisonChart').getContext('2d');
    if (comparisonChart) {
        comparisonChart.destroy();
    }
    
    comparisonChart = new Chart(comparisonCtx, {
        type: 'bar',
        data: {
            labels: sortedMonths.map(month => {
                const [year, m] = month.split('-');
                return new Date(year, m - 1).toLocaleDateString('id-ID', { month: 'short', year: 'numeric' });
            }),
            datasets: [
                {
                    label: 'Pemasukan',
                    data: incomeData,
                    backgroundColor: 'rgba(40, 167, 69, 0.7)',
                    borderColor: 'rgba(40, 167, 69, 1)',
                    borderWidth: 1
                },
                {
                    label: 'Pengeluaran',
                    data: expenseData,
                    backgroundColor: 'rgba(220, 53, 69, 0.7)',
                    borderColor: 'rgba(220, 53, 69, 1)',
                    borderWidth: 1
                }
            ]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return formatCurrency(value);
                        }
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            label += formatCurrency(context.raw);
                            return label;
                        }
                    }
                }
            }
        }
    });

    const trendCtx = document.getElementById('trendChart').getContext('2d');
    if (trendChart) {
        trendChart.destroy();
    }

    const categorySelect = document.getElementById('category-trend-select');
    categorySelect.innerHTML = '';
    
    const expenseCategories = state.categories.filter(c => c.type === 'expense');
    expenseCategories.forEach(category => {
        const option = document.createElement('option');
        option.value = category.id;
        option.textContent = category.name;
        categorySelect.appendChild(option);
    });

    if (expenseCategories.length > 0) {
        renderCategoryTrendChart(expenseCategories[0].id);
    }

    categorySelect.addEventListener('change', (e) => {
        renderCategoryTrendChart(parseInt(e.target.value));
    });

    renderDetailedReport();
}

// Render category trend chart
function renderCategoryTrendChart(categoryId) {
    const trendCtx = document.getElementById('trendChart').getContext('2d');
    
    const monthlyData = {};
    state.transactions
        .filter(t => t.type === 'expense' && t.categoryId === categoryId)
        .forEach(t => {
            const date = new Date(t.date);
            const monthYear = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            
            if (!monthlyData[monthYear]) {
                monthlyData[monthYear] = 0;
            }
            monthlyData[monthYear] += t.amount;
        });
    
    const sortedMonths = Object.keys(monthlyData).sort();
    const amounts = sortedMonths.map(month => monthlyData[month]);
    
    if (trendChart) {
        trendChart.destroy();
    }
    
    trendChart = new Chart(trendCtx, {
        type: 'line',
        data: {
            labels: sortedMonths.map(month => {
                const [year, m] = month.split('-');
                return new Date(year, m - 1).toLocaleDateString('id-ID', { month: 'short', year: 'numeric' });
            }),
            datasets: [{
                label: 'Pengeluaran Bulanan',
                data: amounts,
                backgroundColor: 'rgba(78, 115, 223, 0.05)',
                borderColor: 'rgba(78, 115, 223, 1)',
                borderWidth: 2,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return formatCurrency(value);
                        }
                    }
                }
            },
            plugins: {
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return `${context.dataset.label}: ${formatCurrency(context.raw)}`;
                        }
                    }
                }
            }
        }
    });
}

// Render detailed report table
function renderDetailedReport() {
    const tableBody = document.getElementById('detailed-report');
    tableBody.innerHTML = '';
    
    const now = new Date();
    const currentMonth = now.getMonth();
    const currentYear = now.getFullYear();
    
    const prevMonth = currentMonth === 0 ? 11 : currentMonth - 1;
    const prevYear = currentMonth === 0 ? currentYear - 1 : currentYear;
    
    const currentMonthStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;
    const prevMonthStr = `${prevYear}-${String(prevMonth + 1).padStart(2, '0')}`;
    
    const categoryData = {};
    
    state.transactions.forEach(t => {
        if (t.type === 'expense') {
            const date = new Date(t.date);
            const monthYear = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
            const category = state.categories.find(c => c.id === t.categoryId) || { name: 'Lainnya' };
            
            if (!categoryData[category.name]) {
                categoryData[category.name] = {
                    currentMonth: 0,
                    prevMonth: 0
                };
            }
            
            if (monthYear === currentMonthStr) {
                categoryData[category.name].currentMonth += t.amount;
            } else if (monthYear === prevMonthStr) {
                categoryData[category.name].prevMonth += t.amount;
            }
        }
    });
    
    let totalCurrent = 0;
    let totalPrevious = 0;
    
    Object.values(categoryData).forEach(data => {
        totalCurrent += data.currentMonth;
        totalPrevious += data.prevMonth;
    });
    
    Object.entries(categoryData).forEach(([category, data]) => {
        const change = data.prevMonth ? ((data.currentMonth - data.prevMonth) / data.prevMonth) * 100 : 0;
        const percentage = totalCurrent ? (data.currentMonth / totalCurrent) * 100 : 0;
        
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${category}</td>
            <td>${formatCurrency(data.currentMonth)}</td>
            <td>${formatCurrency(data.prevMonth)}</td>
            <td class="${change >= 0 ? 'text-danger' : 'text-success'}">
                ${change.toFixed(1)}% ${change >= 0 ? '↑' : '↓'}
            </td>
            <td>${percentage.toFixed(1)}%</td>
        `;
        tableBody.appendChild(row);
    });
    
    const totalChange = totalPrevious ? ((totalCurrent - totalPrevious) / totalPrevious) * 100 : 0;
    const totalRow = document.createElement('tr');
    totalRow.className = 'table-active';
    totalRow.innerHTML = `
        <td><strong>Total</strong></td>
        <td><strong>${formatCurrency(totalCurrent)}</strong></td>
        <td><strong>${formatCurrency(totalPrevious)}</strong></td>
        <td class="${totalChange >= 0 ? 'text-danger' : 'text-success'}">
            <strong>${totalChange.toFixed(1)}% ${totalChange >= 0 ? '↑' : '↓'}</strong>
        </td>
        <td><strong>100%</strong></td>
    `;
    tableBody.appendChild(totalRow);
}

// Generate AI insights
function generateInsights() {
    const insightsContainer = document.getElementById('ai-insights');
    const healthInsightsContainer = document.getElementById('financial-health-insights');
    const recommendationsContainer = document.getElementById('recommendations-insights');
    
    insightsContainer.innerHTML = '';
    healthInsightsContainer.innerHTML = '';
    recommendationsContainer.innerHTML = '';
    
    document.querySelectorAll('.insight-content').forEach(el => el.classList.remove('show'));
    document.querySelectorAll('.insight-loading').forEach(el => el.style.display = 'flex');
    
    setTimeout(() => {
        const filteredTransactions = filterTransactionsByPeriod();
        const { totalIncome, totalExpense, balance } = calculateTotals(filteredTransactions);
        
        const savingsRate = totalIncome ? (balance / totalIncome) * 100 : 0;
        const expenseRatio = totalIncome ? (totalExpense / totalIncome) * 100 : 100;
        
        let score = 70;
        score += Math.min(20, savingsRate);
        score -= Math.max(0, expenseRatio - 70) / 2;
        score = Math.max(0, Math.min(100, Math.round(score)));
        
        document.getElementById('financial-score').textContent = score;
        
        const scoreCircle = document.querySelector('.score-circle');
        scoreCircle.style.background = `conic-gradient(var(--success-color) ${score}%, #eee ${score}% 100%)`;
        
        document.getElementById('savings-score').style.width = `${Math.min(100, savingsRate)}%`;
        document.getElementById('spending-score').style.width = `${Math.min(100, 100 - (expenseRatio / 2))}%`;
        document.getElementById('budgeting-score').style.width = `${Math.min(100, score)}%`;
        
        let healthHTML = '';
        
        if (savingsRate >= 20) {
            healthHTML += `
                <div class="insight-item">
                    <div class="insight-title text-success">
                        <i class="fas fa-check-circle me-2"></i> Tingkat Tabungan Bagus
                    </div>
                    <div class="insight-text">
                        Tingkat tabungan Anda ${savingsRate.toFixed(1)}%, di atas rekomendasi 20%. Pertahankan kebiasaan baik ini!
                    </div>
                </div>
            `;
        } else if (savingsRate >= 10) {
            healthHTML += `
                <div class="insight-item">
                    <div class="insight-title text-warning">
                        

                 <i class="fas fa-exclamation-circle me-2"></i> Tingkat Tabungan Sedang
                            </div>
                            <div class="insight-text">
                                Tingkat tabungan Anda ${savingsRate.toFixed(1)}%, di bawah rekomendasi 20%. 
                                Pertimbangkan untuk meningkatkan tabungan dengan mengurangi pengeluaran atau menambah pendapatan.
                            </div>
                        </div>
                    `;
                } else {
                    healthHTML += `
                        <div class="insight-item">
                            <div class="insight-title text-danger">
                                <i class="fas fa-exclamation-triangle me-2"></i> Tingkat Tabungan Rendah
                            </div>
                            <div class="insight-text">
                                Tingkat tabungan Anda hanya ${savingsRate.toFixed(1)}%, sangat rendah. 
                                Targetkan menabung minimal 20% dari pendapatan untuk keamanan finansial.
                            </div>
                        </div>
                    `;
                }
                
                if (expenseRatio <= 70) {
                    healthHTML += `
                        <div class="insight-item">
                            <div class="insight-title text-success">
                                <i class="fas fa-check-circle me-2"></i> Pengeluaran Sehat
                            </div>
                            <div class="insight-text">
                                Anda menghabiskan ${expenseRatio.toFixed(1)}% dari pendapatan, menyisakan cukup untuk tabungan. 
                                Ini adalah kebiasaan finansial yang baik.
                            </div>
                        </div>
                    `;
                } else {
                    healthHTML += `
                        <div class="insight-item">
                            <div class="insight-title text-danger">
                                <i class="fas fa-exclamation-triangle me-2"></i> Pengeluaran Tinggi
                            </div>
                            <div class="insight-text">
                                Anda menghabiskan ${expenseRatio.toFixed(1)}% dari pendapatan, menyisakan sedikit untuk tabungan. 
                                Pertimbangkan untuk meninjau pengeluaran Anda.
                            </div>
                        </div>
                    `;
                }
                
                healthInsightsContainer.innerHTML = healthHTML;
                
                let recommendationsHTML = '';
                
                const expensesByCategory = {};
                filteredTransactions
                    .filter(t => t.type === 'expense')
                    .forEach(t => {
                        const category = state.categories.find(c => c.id === t.categoryId) || { name: 'Lainnya' };
                        if (!expensesByCategory[category.name]) {
                            expensesByCategory[category.name] = 0;
                        }
                        expensesByCategory[category.name] += t.amount;
                    });
                
                const topCategories = Object.entries(expensesByCategory)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3);
                
                if (topCategories.length > 0) {
                    recommendationsHTML += `
                        <div class="insight-item">
                            <div class="insight-title">
                                <i class="fas fa-chart-pie me-2"></i> Kategori Pengeluaran Terbesar
                            </div>
                            <div class="insight-text">
                                Kategori pengeluaran terbesar Anda:
                                <ul>
                                    ${topCategories.map(([name, amount]) => `
                                        <li><strong>${name}</strong>: ${formatCurrency(amount)} (${(amount / totalExpense * 100).toFixed(1)}% dari pengeluaran)</li>
                                    `).join('')}
                                </ul>
                                Pertimbangkan untuk meninjau kategori ini untuk penghematan.
                            </div>
                        </div>
                    `;
                }
                
                if (state.users[state.currentUser].monthlyBudget) {
                    const budgetUsage = (totalExpense / state.users[state.currentUser].monthlyBudget) * 100;
                    
                    if (budgetUsage > 100) {
                        recommendationsHTML += `
                            <div class="insight-item">
                                <div class="insight-title text-danger">
                                    <i class="fas fa-exclamation-triangle me-2"></i> Melebihi Anggaran
                                </div>
                                <div class="insight-text">
                                    Anda telah melebihi anggaran bulanan sebesar ${formatCurrency(totalExpense - state.users[state.currentUser].monthlyBudget)} 
                                    (${budgetUsage.toFixed(1)}% dari anggaran). Coba kurangi pengeluaran di minggu-minggu mendatang.
                                </div>
                            </div>
                        `;
                    } else if (budgetUsage > 80) {
                        recommendationsHTML += `
                            <div class="insight-item">
                                <div class="insight-title text-warning">
                                    <i class="fas fa-exclamation-circle me-2"></i> Mendekati Batas Anggaran
                                </div>
                                <div class="insight-text">
                                    Anda telah menggunakan ${budgetUsage.toFixed(1)}% dari anggaran bulanan. 
                                    Hati-hati dengan pengeluaran tambahan bulan ini.
                                </div>
                            </div>
                        `;
                    } else {
                        recommendationsHTML += `
                            <div class="insight-item">
                                <div class="insight-title text-success">
                                    <i class="fas fa-check-circle me-2"></i> Dalam Anggaran
                                </div>
                                <div class="insight-text">
                                    Anda telah menggunakan ${budgetUsage.toFixed(1)}% dari anggaran bulanan. 
                                    Kerja bagus dalam mengelola pengeluaran!
                                </div>
                            </div>
                        `;
                    }
                }
                
                if (state.users[state.currentUser].savingsGoal) {
                    const currentSavingsRate = (balance / totalIncome) * 100;
                    
                    if (currentSavingsRate >= state.users[state.currentUser].savingsGoal) {
                        recommendationsHTML += `
                            <div class="insight-item">
                                <div class="insight-title text-success">
                                    <i class="fas fa-check-circle me-2"></i> Mencapai Target Tabungan
                                </div>
                                <div class="insight-text">
                                    Anda menabung ${currentSavingsRate.toFixed(1)}% dari pendapatan, memenuhi target 
                                    ${state.users[state.currentUser].savingsGoal}%. Kerja bagus!
                                </div>
                            </div>
                        `;
                    } else {
                        const needed = (state.users[state.currentUser].savingsGoal / 100 * totalIncome) - balance;
                        recommendationsHTML += `
                            <div class="insight-item">
                                <div class="insight-title text-warning">
                                    <i class="fas fa-exclamation-circle me-2"></i> Di Bawah Target Tabungan
                                </div>
                                <div class="insight-text">
                                    Anda menabung ${currentSavingsRate.toFixed(1)}% dari pendapatan, di bawah target 
                                    ${state.users[state.currentUser].savingsGoal}%. Anda perlu menabung tambahan 
                                    ${formatCurrency(needed)} periode ini untuk mencapai target.
                                </div>
                            </div>
                        `;
                    }
                }
                
                recommendationsContainer.innerHTML = recommendationsHTML;
                
                let dashboardHTML = '';
                
                if (balance > 0) {
                    dashboardHTML += `
                        <div class="insight-item">
                            <div class="insight-title text-success">
                                <i class="fas fa-smile me-2"></i> Arus Kas Positif
                            </div>
                            <div class="insight-text">
                                Anda memiliki saldo positif sebesar ${formatCurrency(balance)} periode ini. 
                                Pertimbangkan untuk mengalokasikan sebagian ke tabungan atau investasi.
                            </div>
                        </div>
                    `;
                } else {
                    dashboardHTML += `
                        <div class="insight-item">
                            <div class="insight-title text-danger">
                                <i class="fas fa-frown me-2"></i> Arus Kas Negatif
                            </div>
                            <div class="insight-text">
                                Anda memiliki saldo negatif sebesar ${formatCurrency(-balance)} periode ini. 
                                Tinjau pengeluaran Anda untuk menghindari pemborosan.
                            </div>
                        </div>
                    `;
                }
                
                const now = new Date();
                let prevPeriodStart, prevPeriodEnd;
                
                switch (state.currentPeriod) {
                    case 'today':
                        prevPeriodStart = prevPeriodEnd = formatDate(new Date(now.setDate(now.getDate() - 1)));
                        break;
                    case 'week':
                        prevPeriodStart = new Date(now);
                        prevPeriodStart.setDate(now.getDate() - 7 - now.getDay());
                        prevPeriodEnd = new Date(prevPeriodStart);
                        prevPeriodEnd.setDate(prevPeriodStart.getDate() + 6);
                        prevPeriodStart = formatDate(prevPeriodStart);
                        prevPeriodEnd = formatDate(prevPeriodEnd);
                        break;
                    case 'month':
                        prevPeriodStart = new Date(now.getFullYear(), now.getMonth() - 1, 1);
                        prevPeriodEnd = new Date(now.getFullYear(), now.getMonth(), 0);
                        prevPeriodStart = formatDate(prevPeriodStart);
                        prevPeriodEnd = formatDate(prevPeriodEnd);
                        break;
                    case 'year':
                        prevPeriodStart = new Date(now.getFullYear() - 1, 0, 1);
                        prevPeriodEnd = new Date(now.getFullYear() - 1, 11, 31);
                        prevPeriodStart = formatDate(prevPeriodStart);
                        prevPeriodEnd = formatDate(prevPeriodEnd);
                        break;
                    default:
                        if (typeof state.currentPeriod === 'object') {
                            const start = new Date(state.currentPeriod.start);
                            const end = new Date(state.currentPeriod.end);
                            const diff = end - start;
                            
                            prevPeriodStart = new Date(start.getTime() - diff - 86400000);
                            prevPeriodEnd = new Date(start.getTime() - 86400000);
                            prevPeriodStart = formatDate(prevPeriodStart);
                            prevPeriodEnd = formatDate(prevPeriodEnd);
                        }
                }
                
                if (prevPeriodStart && prevPeriodEnd) {
                    const prevTransactions = state.transactions.filter(t => t.date >= prevPeriodStart && t.date <= prevPeriodEnd);
                    const { totalIncome: prevIncome, totalExpense: prevExpense, balance: prevBalance } = calculateTotals(prevTransactions);
                    
                    const incomeChange = prevIncome ? ((totalIncome - prevIncome) / prevIncome) * 100 : 0;
                    const expenseChange = prevExpense ? ((totalExpense - prevExpense) / prevExpense) * 100 : 0;
                    const balanceChange = prevBalance ? ((balance - prevBalance) / prevBalance) * 100 : 0;
                    
                    dashboardHTML += `
                        <div class="insight-item">
                            <div class="insight-title">
                                <i class="fas fa-chart-line me-2"></i> Perbandingan Periode
                            </div>
                            <div class="insight-text">
                                <ul>
                                    <li>Pendapatan: ${incomeChange >= 0 ? '↑' : '↓'} ${Math.abs(incomeChange).toFixed(1)}% 
                                        (${formatCurrency(totalIncome)} vs ${formatCurrency(prevIncome)})</li>
                                    <li>Pengeluaran: ${expenseChange >= 0 ? '↑' : '↓'} ${Math.abs(expenseChange).toFixed(1)}% 
                                        (${formatCurrency(totalExpense)} vs ${formatCurrency(prevExpense)})</li>
                                    <li>Saldo: ${balanceChange >= 0 ? '↑' : '↓'} ${Math.abs(balanceChange).toFixed(1)}% 
                                        (${formatCurrency(balance)} vs ${formatCurrency(prevBalance)})</li>
                                </ul>
                            </div>
                        </div>
                    `;
                }
                
                insightsContainer.innerHTML = dashboardHTML;
                
                document.querySelectorAll('.insight-loading').forEach(el => el.style.display = 'none');
                document.querySelectorAll('.insight-content').forEach(el => el.classList.add('show'));
            }, 1500);
        }

        // Render user settings
        function renderUserSettings() {
            const user = state.users[state.currentUser];
            document.getElementById('user-name').value = user.name;
            document.getElementById('user-email').value = user.email;
            document.getElementById('user-currency').value = user.currency;
            document.getElementById('monthly-budget').value = user.monthlyBudget;
            document.getElementById('savings-goal').value = user.savingsGoal;
            document.getElementById('notifications-enabled').checked = user.notificationsEnabled;
        }

        // Show confirmation dialog
        function showConfirmation(title, message, callback) {
            document.getElementById('confirmationModalTitle').textContent = title;
            document.getElementById('confirmationModalBody').textContent = message;
            
            confirmActionBtn.onclick = function() {
                callback();
                confirmationModal.hide();
            };
            
            confirmationModal.show();
        }

        // Export all data to Excel
        function exportAllData() {
            const transactionsWS = XLSX.utils.json_to_sheet(state.transactions.map(t => {
                const category = state.categories.find(c => c.id === t.categoryId);
                return {
                    Tanggal: t.date,
                    Jenis: t.type === 'income' ? 'Pemasukan' : 'Pengeluaran',
                    Kategori: category ? category.name : 'Lainnya',
                    Keterangan: t.description,
                    Jumlah: t.amount,
                    'Jumlah (Format)': formatCurrency(t.amount)
                };
            }));
            
            const categoriesWS = XLSX.utils.json_to_sheet(state.categories.map(c => ({
                Nama: c.name,
                Jenis: c.type === 'income' ? 'Pemasukan' : 'Pengeluaran',
                Ikon: c.icon,
                Warna: c.color
            })));
            
            const userWS = XLSX.utils.json_to_sheet([{
                Nama: state.users[state.currentUser].name,
                Email: state.users[state.currentUser].email,
                'Mata Uang': state.users[state.currentUser].currency,
                'Anggaran Bulanan': state.users[state.currentUser].monthlyBudget,
                'Target Tabungan (%)': state.users[state.currentUser].savingsGoal,
                'Notifikasi Aktif': state.users[state.currentUser].notificationsEnabled ? 'Ya' : 'Tidak'
            }]);
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, transactionsWS, "Transaksi");
            XLSX.utils.book_append_sheet(wb, categoriesWS, "Kategori");
            XLSX.utils.book_append_sheet(wb, userWS, "Pengaturan");
            
            const date = new Date();
            const dateStr = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
            XLSX.writeFile(wb, `BudgetGenius_SemuaData_${dateStr}.xlsx`);
        }

        // Export report to Excel
        function exportReport() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            const prevMonth = currentMonth === 0 ? 11 : currentMonth - 1;
            const prevYear = currentMonth === 0 ? currentYear - 1 : currentYear;
            
            const currentMonthStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;
            const prevMonthStr = `${prevYear}-${String(prevMonth + 1).padStart(2, '0')}`;
            
            const categoryData = {};
            
            state.transactions.forEach(t => {
                if (t.type === 'expense') {
                    const date = new Date(t.date);
                    const monthYear = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                    const category = state.categories.find(c => c.id === t.categoryId) || { name: 'Lainnya' };
                    
                    if (!categoryData[category.name]) {
                        categoryData[category.name] = {
                            currentMonth: 0,
                            prevMonth: 0
                        };
                    }
                    
                    if (monthYear === currentMonthStr) {
                        categoryData[category.name].currentMonth += t.amount;
                    } else if (monthYear === prevMonthStr) {
                        categoryData[category.name].prevMonth += t.amount;
                    }
                }
            });
            
            const reportData = Object.entries(categoryData).map(([category, data]) => {
                const change = data.prevMonth ? ((data.currentMonth - data.prevMonth) / data.prevMonth) * 100 : 0;
                const percentage = data.currentMonth ? (data.currentMonth / Object.values(categoryData).reduce((sum, d) => sum + d.currentMonth, 0)) * 100 : 0;
                
                return {
                    Kategori: category,
                    'Bulan Ini': data.currentMonth,
                    'Bulan Lalu': data.prevMonth,
                    Perubahan: `${change.toFixed(1)}% ${change >= 0 ? '↑' : '↓'}`,
                    'Persentase': `${percentage.toFixed(1)}%`
                };
            });
            
            const totalCurrent = Object.values(categoryData).reduce((sum, d) => sum + d.currentMonth, 0);
            const totalPrevious = Object.values(categoryData).reduce((sum, d) => sum + d.prevMonth, 0);
            const totalChange = totalPrevious ? ((totalCurrent - totalPrevious) / totalPrevious) * 100 : 0;
            
            reportData.push({
                Kategori: 'TOTAL',
                'Bulan Ini': totalCurrent,
                'Bulan Lalu': totalPrevious,
                Perubahan: `${totalChange.toFixed(1)}% ${totalChange >= 0 ? '↑' : '↓'}`,
                'Persentase': '100%'
            });
            
            const ws = XLSX.utils.json_to_sheet(reportData);
            
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Laporan");
            
            const date = new Date();
            const dateStr = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
            XLSX.writeFile(wb, `BudgetGenius_Laporan_${dateStr}.xlsx`);
        }

        // Reset all data
        function resetAllData() {
            state.users[state.currentUser].transactions = [];
            state.users[state.currentUser].categories = getDefaultCategories();
            state.users[state.currentUser].monthlyBudget = 0;
            state.users[state.currentUser].savingsGoal = 20;
            
            state.transactions = [];
            state.categories = state.users[state.currentUser].categories;
            
            saveToLocalStorage();
            
            updateDashboard();
            renderRecentTransactions();
            renderAllCategories();
            renderAllTransactions();
            renderUserSettings();
            
            alert('Semua data telah direset ke kondisi awal');
        }
// Initialize the app when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Check auth state
    auth.onAuthStateChanged(async (user) => {
        if (user) {
            // User is signed in
            await loginUser(user);
        } else {
            // No user is signed in
            loginModal.show();
        }
    });
    
    // Initialize the app
    init();
});
    </script>
</body>
</html>
